<meta charset="utf-8">
<div id="app"></div>
<hr>
<h3>已解决：</h3>
<ul>
  <li>改造 Profile 需要增加 prop 来接收状态，也需要增加响应父级事件的 emit</li>
  <li>改造 Editor 需要增加 on 事件绑定来改变自身 data</li>
  <li>这种改造是毁灭性的，想象上面两个组件在其他视图中已被使用 n 次</li>
  <li>Components 之间的层级因传递数据而变得很糟糕，项目将越来越不可维护</li>
  <li>如果用 Event Bus 会解决嵌套层级的问题，但会产生多份拷贝，每次修改 state 都需要手动 emit</li>
  <li>更不用说 <a href="https://cn.vuejs.org/v2/guide/components-edge-cases.html#访问子组件实例或子元素" target="_blank">逃生舱 Refs</a> 来同步状态</li>
</ul>
<script src="https://unpkg.com/vue@2.6.10/dist/vue.js"></script>
<script src="https://unpkg.com/vuex@3.1.1/dist/vuex.js"></script>
<script>
  let store = new Vuex.Store({
    state: {
      age: 0
    },
    mutations: {
      UPDATE_AGE (state, newAge) {
        state.age = newAge
      }
    },
    actions: {
      updateProfile ({ commit }, payload) {
        setTimeout(() => {
          commit('UPDATE_AGE', payload.age)
        }, 2000)
      }
    },
    getters: {
      avatar: state => {
        return state.age < 18 ? 'minor.png' : 'major.png'
      }
    }
  })
</script>
<script>
  Vue.component('Profile', {
    template: `
      <div>
        Age: <input type="range" v-model.lazy="age">
        <detail />
      </div>
    `,
    computed: {
      age: {
        get: function () {
          return store.state.age
        },
        set: function (v) {
          store.dispatch({
            type: 'updateProfile',
            age: v
          })
        }
      }
    }
  })
  Vue.component('Editor', {
    template: `
      <div>
        Age: <input type="text" v-model.lazy="age">
      </div>
    `,
    computed: {
      age: {
        get: function () {
          return store.state.age
        },
        set: function (v) {
          store.dispatch({
            type: 'updateProfile',
            age: v
          })
        }
      }
    }
  })
  Vue.component('Detail', {
    template: `
      <div>
        I am <b>{{ age }}</b> years old.
      </div>
    `,
    computed: {
      age () {
        return store.state.age
      }
    }
  })
</script>
<script>
  new Vue({
    el: '#app',
    template: `
      <div>
        <editor />
        <profile />
      </div>
    `
  })
</script>
